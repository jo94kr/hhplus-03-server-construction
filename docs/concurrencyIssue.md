# 동시성 문제와 극복

## 비즈니스 로직 중 발생 가능한 동시성 이슈 파악

### 동시성 이슈가 발생할 부분

- 좌석 예약
- 결제
- 잔액 충전

## 동시성 제어 방식 도입

### 비관적 락

> 자원 요청에 따른 동시성문제가 발생할것이라고 예상하고 락을 거는 방법

- 장점
  - 충돌이 자주 발생하는 환경에서는 롤백 횟수를 줄여서 성능상 유리
  - 데이터 무결성을 보장하는 수준이 높다
- 단점
  - 하나의 트랜잭션이 자원에 접근시 락을 걸고 다른트랜잭션이 접근하지 못하게하므로 읽기가 많은 경우 성능상 손해
  - 서로 자원이 필요한 경우에, 락이 걸려있으므로 데드락이 일어날 가능성이 있음

### 낙관적 락

> 자원에 락을 걸어서 선점하지않고 동시성 문제가 발생하면 처리하는 방법

- 장점
  - 충돌이 발생하지 않는다는 가정하에 동시 요청에 대한 처리 성능이 유리
- 단점
  - 잦은 충돌이 일어나는경우 롤백처리에 대한 비용이 많이 들어 오히려 성능상 손해

### Redis

> 메모리 기반의 데이터 저장소 키-밸류(key-value) 데이터 구조에 기반한 다양한 형태의 자료 구조를 제공하며, 데이터들을 저장할 수 있는 저장소

- 장점
  - 메모리 기반이므로 빠르게 락을 획득 및 해제 가능
- 단점
  - 레디스 서버가 다운되거나 문제가 발생하면 해당 레디스 서버에 접근하는 모든 클라이언트가 영향을 받을 수 있기에, 레디스 서버가 단일 장애 지점이 될 위험이 있음.

### Kafka

> 파이프라인, 스트리밍 분석, 데이터 통합 및 미션 크리티컬 애플리케이션을 위해 설계된 고성능 분산 이벤트 스트리밍 플랫폼.
> Pub-Sub 모델의 메시지 큐 형태로 동작하며 분산환경에 특화.

- 장점
  - 다수의 브로커로 구성되어 있어, 하나의 브로커가 다운되더라도 다른 브로커가 대신 처리할 수 있어, 고가용성을 보장
- 단점
  - 서버의 수와 스토리지의 용량에 따라 비용이 증가, 관리 복잡
